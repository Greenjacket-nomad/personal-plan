<!-- Sidebar -->
<div class="lg:col-span-1 space-y-4">
    <div class="card p-4">
        <div class="flex items-center justify-between mb-3">
            <h2 class="font-bold text-primary"><i class="fas fa-book mr-2"></i>Phases</h2>
            <div class="flex items-center gap-2">
                <button onclick="navigateWeek('prev')" class="text-sm px-2 py-1 btn-secondary" title="Previous week">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button onclick="navigateWeek('next')" class="text-sm px-2 py-1 btn-primary" title="Next week">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        {% for p in phases %}
        <form action="/jump-to-phase/{{ p.index }}" method="POST" class="mb-2">
            <button type="submit" class="w-full text-left p-3 rounded-lg transition-all card {% if p.is_current %}phase-current{% elif p.is_complete %}phase-complete{% else %}phase-default{% endif %}">
                <div class="flex items-center gap-2">
                    {% if p.is_complete %}<i class="fas fa-check-circle text-success"></i>
                    {% elif p.is_current %}<i class="fas fa-play-circle text-accent"></i>
                    {% else %}<i class="far fa-circle text-muted"></i>{% endif %}
                    {% set short_name = p.name.replace('PHASE ' + (p.index + 1)|string + ': ', '')|title %}
                    <span class="text-sm font-medium text-primary">{{ p.index + 1 }}. {{ short_name }}</span>
                </div>
                <div class="text-xs mt-1 ml-6 text-secondary">{{ p.metrics_done }}/{{ p.metrics_total }} Â· {{ "%.0f"|format(p.logged) }}/{{ p.hours }}h</div>
            </button>
        </form>
        {% endfor %}
    </div>
    
    <!-- Log Time Card (MOVED HERE) -->
    <div class="card p-4">
        <div class="flex items-center justify-between mb-3 cursor-pointer" onclick="toggleLogTime()">
            <h3 class="font-bold text-primary"><i class="fas fa-clock mr-2"></i>Log Time</h3>
            <i class="fas fa-chevron-down transition-transform" id="log-time-chevron"></i>
        </div>
        <div id="log-time-content" class="hidden-field">
        <form action="/log" method="POST" class="space-y-3 mb-4">
            <div>
                <label class="block text-xs mb-1 text-secondary">Hours</label>
                <input type="number" name="hours" step="0.25" min="0.25" value="1" class="w-full">
            </div>
            <div>
                <label class="block text-xs mb-1 text-secondary">Date</label>
                <input type="date" name="date" value="{{ today }}" class="w-full">
            </div>
            <div>
                <label class="block text-xs mb-1 text-secondary">Week (opt)</label>
                <select name="week" class="w-full">
                    <option value="">Any</option>
                    {% for w in range(1, phase.weeks + 1) %}
                    <option value="{{ w }}" {% if w == current_week %}selected{% endif %}>W{{ w }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs mb-1 text-secondary">Day (opt)</label>
                <select name="day" class="w-full">
                    <option value="">Any</option>
                    {% for d in range(1, 7) %}
                    <option value="{{ d }}">D{{ d }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs mb-1 text-secondary">Resource (opt)</label>
                <select name="resource_id" class="w-full text-sm">
                    <option value="">General time</option>
                    {% for day in [1,2,3,4,5,6] %}
                        {% if grouped_week_resources[day] %}
                            <optgroup label="Day {{ day }}">
                            {% for r in grouped_week_resources[day] %}
                                <option value="{{ r.id }}">{{ r.title[:50] }}</option>
                            {% endfor %}
                            </optgroup>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs mb-1 text-secondary">Notes</label>
                <input type="text" name="notes" placeholder="What did you study?" class="w-full">
            </div>
            <div>
                <button type="submit" class="btn-primary w-full"><i class="fas fa-plus mr-1"></i>Log Time</button>
            </div>
        </form>
        {% if recent_logs %}
        <div class="mt-4 flex flex-wrap gap-2">
            {% for log in recent_logs %}
            <div class="inline-flex items-center gap-2 tag">
                <span class="text-secondary">{{ log.date }}</span>
                <span class="font-bold text-accent">{{ log.hours }}h</span>
                <form action="/delete-log/{{ log.date }}" method="POST" class="inline">
                    <button class="btn-delete transition-all"><i class="fas fa-times text-xs"></i></button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        </div>
    </div>
    
</div>

