<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Reports - Curriculum Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/static/design-system.css">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Page-specific styles - design system variables are in design-system.css */
        .card {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 1.5rem;
        }
        
        .header {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent);
        }
        
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-muted { color: var(--text-muted); }
        .text-accent { color: var(--accent); }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        
        /* Navigation Styles */
        .nav-item {
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: all 150ms ease;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }
        
        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--accent);
        }
        
        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--accent);
            font-weight: 600;
        }
        
        .header a.text-2xl:hover {
            transform: scale(1.05);
            transition: transform 150ms ease;
        }
        
        #breadcrumbs {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        #breadcrumbs a {
            color: var(--text-secondary);
            transition: color 150ms ease;
        }
        
        #breadcrumbs a:hover {
            color: var(--accent);
        }
        
        #mobile-menu {
            border-top: 1px solid var(--border);
            margin-top: 1rem;
            padding-top: 1rem;
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 150ms ease;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .theme-toggle {
            cursor: pointer;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.5rem;
            transition: all 150ms ease;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
    </style>
    <script>
        // Load theme before page renders to prevent flash
        (function() {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <script src="/static/js/accessibility.js"></script>
</head>
<body class="min-h-screen">
    <a href="#main-content" id="skip-to-main" class="skip-to-main">Skip to main content</a>
    
    <!-- Sidebar Navigation (Desktop) -->
    {% set current_page = 'reports' %}
    {% set user_name = current_user.username if current_user else 'User' %}
    {% include 'components/_sidebar_nav.html' %}
    
    <!-- Mobile Tab Bar (Mobile) -->
    {% set current_page = 'reports' %}
    {% include 'components/_mobile_tabbar.html' %}
    
    <!-- Main Content Wrapper -->
    <div class="main-content-wrapper">
    <a href="#main-content" id="skip-to-main" class="skip-to-main">Skip to main content</a>
    <header class="header py-6 px-8">
        <div class="max-w-7xl mx-auto">
            <!-- Unified Navigation -->
            <div class="flex items-center justify-between">
                <!-- Left: Logo + Breadcrumbs -->
                <div class="flex items-center gap-6">
                    <a href="/" class="text-2xl font-bold text-primary hover:text-accent transition-all" title="Dashboard">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="hidden md:inline">Curriculum Tracker</span>
                    </a>
                    {% if request.path != '/' %}
                    <button onclick="goBack()" class="btn-secondary px-3 py-2 text-sm">
                        <i class="fas fa-arrow-left mr-1"></i>
                        <span class="hidden md:inline">Back</span>
                    </button>
                    {% endif %}
                    <div id="breadcrumbs" class="text-sm text-secondary hidden md:flex items-center gap-2">
                        <!-- Dynamic breadcrumbs inserted here -->
                    </div>
                </div>
                
                <!-- Right: Navigation + Utilities -->
                <div class="flex items-center gap-6">
                    <!-- Main Navigation -->
                    <nav class="hidden md:flex items-center gap-4">
                        <a href="/" class="nav-item {% if request.path == '/' or request.path.startswith('/view/') %}active{% endif %}">
                            <i class="fas fa-home mr-1"></i>Dashboard
                        </a>
                        <a href="/resources" class="nav-item {% if '/resources' in request.path or '/curriculum' in request.path %}active{% endif %}">
                            <i class="fas fa-book mr-1"></i>Curriculum
                        </a>
                        <a href="/journal" class="nav-item {% if '/journal' in request.path %}active{% endif %}">
                            <i class="fas fa-book-open mr-1"></i>Journal
                        </a>
                        <a href="/calendar" class="nav-item {% if '/calendar' in request.path %}active{% endif %}">
                            <i class="fas fa-calendar mr-1"></i>Calendar
                        </a>
                        <a href="/reports" class="nav-item {% if '/reports' in request.path %}active{% endif %}">
                            <i class="fas fa-chart-bar mr-1"></i>Reports
                        </a>
                        <a href="/activity" class="nav-item {% if '/activity' in request.path %}active{% endif %}">
                            <i class="fas fa-history mr-1"></i>Activity
                        </a>
                    </nav>
                    
                    <!-- Utilities -->
                    <div class="flex items-center gap-3">
                        <button onclick="toggleTheme()" class="theme-toggle" title="Toggle dark mode">
                            <span class="theme-icon"></span>
                        </button>
                    </div>
                    
                    <!-- Mobile Menu Toggle -->
                    <button onclick="toggleMobileMenu()" class="md:hidden text-primary">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu (hidden by default) -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
                <nav class="flex flex-col gap-3">
                    <a href="/" class="nav-item {% if request.path == '/' or request.path.startswith('/view/') %}active{% endif %}"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="/resources" class="nav-item {% if '/resources' in request.path or '/curriculum' in request.path %}active{% endif %}"><i class="fas fa-book mr-2"></i>Curriculum</a>
                    <a href="/journal" class="nav-item {% if '/journal' in request.path %}active{% endif %}"><i class="fas fa-book-open mr-2"></i>Journal</a>
                    <a href="/calendar" class="nav-item {% if '/calendar' in request.path %}active{% endif %}"><i class="fas fa-calendar mr-2"></i>Calendar</a>
                    <a href="/reports" class="nav-item {% if '/reports' in request.path %}active{% endif %}"><i class="fas fa-chart-bar mr-2"></i>Reports</a>
                    <a href="/activity" class="nav-item {% if '/activity' in request.path %}active{% endif %}"><i class="fas fa-history mr-2"></i>Activity</a>
                </nav>
            </div>
        </div>
    </header>
    
    <main id="main-content" class="max-w-7xl mx-auto p-6">
        <!-- Key Insights Hero Section -->
        <div class="key-insights-hero mb-8">
            <div class="card p-6 bg-gradient-to-r from-accent/10 to-accent/5 border-2 border-accent">
                <h1 class="text-3xl font-bold text-primary mb-4">Key Insights</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="insight-metric">
                        <div class="insight-metric-value text-4xl font-bold text-accent">
                            {{ "%.1f"|format(reports.total_hours) }}h
                        </div>
                        <div class="insight-metric-label text-secondary">Total Learning Time</div>
                        <div class="insight-metric-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+{{ "%.1f"|format(reports.daily_avg * 7) }}h this week</span>
                        </div>
                    </div>
                    <div class="insight-metric">
                        <div class="insight-metric-value text-4xl font-bold {% if reports.daily_avg >= reports.needed_daily %}text-success{% else %}text-warning{% endif %}">
                            {{ "%.1f"|format(reports.daily_avg) }}h
                        </div>
                        <div class="insight-metric-label text-secondary">Daily Average</div>
                        <div class="insight-metric-trend {% if reports.daily_avg >= reports.needed_daily %}positive{% else %}negative{% endif %}">
                            <i class="fas fa-{% if reports.daily_avg >= reports.needed_daily %}check{% else %}exclamation{% endif %}"></i>
                            <span>{% if reports.daily_avg >= reports.needed_daily %}On track{% else %}Below target{% endif %}</span>
                        </div>
                    </div>
                    <div class="insight-metric">
                        <div class="insight-metric-value text-4xl font-bold text-primary">
                            {{ reports.by_phase|length if reports.by_phase else 0 }}
                        </div>
                        <div class="insight-metric-label text-secondary">Active Phases</div>
                        <div class="insight-metric-trend">
                            <span>In progress</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports Header with Controls -->
        <div class="reports-header mb-6">
            <div>
                <h2 class="text-2xl font-bold text-primary mb-2">Detailed Analytics</h2>
                <p class="text-secondary">Explore your learning patterns in depth</p>
            </div>
            <div class="reports-controls">
                <!-- Date Range Buttons -->
                <div class="date-range-buttons">
                    <button class="date-range-button active" onclick="setDateRange('7d')">Last 7 Days</button>
                    <button class="date-range-button" onclick="setDateRange('30d')">Last 30 Days</button>
                    <button class="date-range-button" onclick="setDateRange('90d')">Last 90 Days</button>
                    <button class="date-range-button" onclick="setDateRange('all')">All Time</button>
                </div>
                
                <!-- Comparison Toggle -->
                <label class="comparison-toggle" onclick="toggleComparison()">
                    <input type="checkbox" id="comparison-mode">
                    <span>Compare Periods</span>
                </label>
                
                <!-- Export Button -->
                <div class="export-button">
                    <button class="btn-primary" onclick="toggleExportDropdown()">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                    <div class="export-dropdown" id="export-dropdown">
                        <div class="export-dropdown-item" onclick="exportReport('pdf')">
                            <i class="fas fa-file-pdf"></i>
                            <span>Export as PDF</span>
                        </div>
                        <div class="export-dropdown-item" onclick="exportReport('csv')">
                            <i class="fas fa-file-csv"></i>
                            <span>Export as CSV</span>
                        </div>
                        <div class="export-dropdown-item" onclick="exportReport('png')">
                            <i class="fas fa-image"></i>
                            <span>Export Charts as PNG</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Insight Cards -->
        <div class="insights-section">
            {% if reports.daily_avg >= reports.needed_daily %}
            <div class="insight-card success">
                <div class="insight-header">
                    <div class="insight-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="insight-title">You're On Track!</div>
                </div>
                <p class="insight-description">
                    Your daily average of {{ "%.2f"|format(reports.daily_avg) }} hours exceeds your target of {{ "%.2f"|format(reports.needed_daily) }} hours. Keep up the excellent work!
                </p>
            </div>
            {% else %}
            <div class="insight-card warning">
                <div class="insight-header">
                    <div class="insight-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="insight-title">Below Target</div>
                </div>
                <p class="insight-description">
                    Your current daily average of {{ "%.2f"|format(reports.daily_avg) }} hours is below the target of {{ "%.2f"|format(reports.needed_daily) }} hours. Consider increasing your daily study time to stay on schedule.
                </p>
            </div>
            {% endif %}
            
            {% if reports.by_phase and reports.by_phase|length > 0 %}
            {% set top_phase = reports.by_phase|sort(attribute='hours', reverse=True)|first %}
            <div class="insight-card info">
                <div class="insight-header">
                    <div class="insight-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="insight-title">Top Performing Phase</div>
                </div>
                <p class="insight-description">
                    Phase {{ top_phase.phase_index + 1 }} has the most hours logged with {{ "%.1f"|format(top_phase.hours) }} hours. This shows strong focus in this area of your curriculum.
                </p>
            </div>
            {% endif %}
        </div>
        
        <!-- Goal Tracking -->
        {% include 'components/_goal_tracking.html' %}
        
        <!-- Loading State -->
        <div id="reports-loading" class="reports-loading hidden">
            <div class="reports-loading-spinner"></div>
            <p class="text-secondary">Generating your report...</p>
        </div>
        
        <!-- Hours by Phase -->
        <div class="card mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-primary">
                    Hours by Phase
                    <span class="metric-info-tooltip">
                        <i class="fas fa-info-circle text-muted cursor-help"></i>
                        <span class="tooltip-text">Shows total hours logged per curriculum phase. The dashed line represents the target of 96 hours per phase.</span>
                    </span>
                </h2>
            </div>
            <div style="height: 300px; max-height: 300px;">
                <canvas id="phase-chart"></canvas>
            </div>
        </div>
        
        <!-- Hours by Resource Type -->
        <div class="card mb-6" id="type-chart-section" data-section="type-chart-section">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-primary">
                    Hours by Resource Type
                    <span class="metric-info-tooltip">
                        <i class="fas fa-info-circle text-muted cursor-help"></i>
                        <span class="tooltip-text">Breakdown of time spent on different types of learning resources (videos, articles, projects, etc.).</span>
                    </span>
                </h2>
            </div>
            <div style="height: 300px; max-height: 300px;">
                <canvas id="type-chart"></canvas>
            </div>
        </div>
        
        <!-- Hours by Week -->
        <div class="card mb-6" id="week-chart-section" data-section="week-chart-section">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-primary">
                    Hours by Week
                    <span class="metric-info-tooltip">
                        <i class="fas fa-info-circle text-muted cursor-help"></i>
                        <span class="tooltip-text">Weekly hours logged over time. The dashed line shows the target of 24 hours per week.</span>
                    </span>
                </h2>
            </div>
            <div style="height: 300px; max-height: 300px;">
                <canvas id="week-chart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        const reportsData = {{ reports|tojson }};
        
        // Store chart instances for theme updates
        let phaseChart = null;
        let typeChart = null;
        let weekChart = null;
        
        function getComputedColor(cssVar) {
            return getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim();
        }
        
        function getCurrentTheme() {
            return document.documentElement.getAttribute('data-theme') || localStorage.getItem('theme') || 'dark';
        }
        
        function getChartColors() {
            const theme = getCurrentTheme();
            return {
                textColor: theme === 'dark' ? '#e5e7eb' : '#1f2937',
                gridColor: theme === 'dark' ? '#374151' : '#e5e7eb',
                backgroundColor: theme === 'dark' ? '#1f2937' : '#ffffff',
                borderColor: theme === 'dark' ? '#4b5563' : '#d1d5db'
            };
        }
        
        function updateChartColors() {
            // Destroy existing charts
            if (phaseChart) phaseChart.destroy();
            if (typeChart) typeChart.destroy();
            if (weekChart) weekChart.destroy();
            
            // Recreate charts with new colors
            createCharts();
        }
        
        // Date range functions
        function setDateRange(range) {
            document.querySelectorAll('.date-range-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show loading
            document.getElementById('reports-loading').classList.remove('hidden');
            
            // In a real implementation, this would fetch new data
            setTimeout(() => {
                document.getElementById('reports-loading').classList.add('hidden');
                createCharts(); // Recreate with filtered data
                showToast('Date range updated', 'success');
            }, 1000);
        }
        
        // Export functions
        function toggleExportDropdown() {
            const dropdown = document.getElementById('export-dropdown');
            dropdown.classList.toggle('show');
        }
        
        function exportReport(format) {
            toggleExportDropdown();
            
            // Show loading state
            if (typeof showToast === 'function') {
                showToast(`Exporting as ${format.toUpperCase()}...`, 'info');
            }
            
            // Trigger download
            if (format === 'csv') {
                window.location.href = '/reports/export/csv';
            } else if (format === 'pdf') {
                window.location.href = '/reports/export/pdf';
            } else if (format === 'png') {
                window.location.href = '/reports/export/png';
            }
            showToast(`Exporting as ${format.toUpperCase()}...`, 'info');
            // In a real implementation, this would trigger download
            setTimeout(() => {
                showToast(`Report exported as ${format.toUpperCase()}`, 'success');
            }, 1000);
        }
        
        // Comparison mode
        function toggleComparison() {
            const checkbox = document.getElementById('comparison-mode');
            const toggle = event.target.closest('.comparison-toggle');
            if (toggle) {
                toggle.classList.toggle('active');
            }
            showToast(checkbox.checked ? 'Comparison mode enabled' : 'Comparison mode disabled', 'info');
            // In a real implementation, this would show/hide comparison data
        }
        
        // Close export dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const exportButton = document.querySelector('.export-button');
            const dropdown = document.getElementById('export-dropdown');
            if (exportButton && dropdown && !exportButton.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        function createCharts() {
            const colors = getChartColors();
            // Hours by Phase
            const phaseCtx = document.getElementById('phase-chart');
            if (phaseCtx && reportsData.by_phase) {
                phaseChart = new Chart(phaseCtx, {
                type: 'bar',
                data: {
                    labels: reportsData.by_phase.map(p => `Phase ${p.phase_index + 1}`),
                    datasets: [{
                        label: 'Hours Logged',
                        data: reportsData.by_phase.map(p => p.hours || 0),
                        backgroundColor: [
                            'var(--phase-1)',
                            'var(--phase-2)',
                            'var(--phase-3)',
                            'var(--phase-4)'
                        ]
                    }, {
                        label: 'Target (96h)',
                        data: reportsData.by_phase.map(() => 96),
                        type: 'line',
                        borderColor: 'var(--accent)',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: colors.textColor
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: colors.textColor,
                                font: { size: 13 }
                            },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: colors.textColor,
                                font: { size: 13 }
                            },
                            grid: { color: colors.gridColor },
                            title: {
                                display: true,
                                text: 'Hours',
                                color: colors.textColor,
                                font: { size: 13 }
                            }
                        }
                    }
                }
                });
            }
            
            // Hours by Type
            const typeCtx = document.getElementById('type-chart');
            if (typeCtx && reportsData.by_type) {
                typeChart = new Chart(typeCtx, {
                type: 'pie',
                data: {
                    labels: reportsData.by_type.map(t => t.resource_type || 'Unknown'),
                    datasets: [{
                        data: reportsData.by_type.map(t => t.hours || 0),
                        backgroundColor: [
                            'var(--accent)',
                            'var(--success)',
                            'var(--warning)',
                            'var(--phase-1)',
                            'var(--phase-2)',
                            'var(--phase-3)',
                            'var(--phase-4)'
                        ],
                        // Add border for better distinction
                        borderWidth: 2,
                        borderColor: colors.backgroundColor
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: colors.textColor,
                                font: { size: 13 }
                            },
                            position: 'right'
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: colors.backgroundColor,
                            titleColor: colors.textColor,
                            bodyColor: colors.textColor,
                            borderColor: colors.borderColor,
                            borderWidth: 1,
                            titleFont: { size: 13 },
                            bodyFont: { size: 12 },
                            padding: 12
                        }
                    },
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const label = this.data.labels[element.index];
                            showToast(`Viewing details for ${label}`, 'info');
                        }
                    }
                }
            });
        }
        
            // Hours by Week
            const weekCtx = document.getElementById('week-chart');
            if (weekCtx && reportsData.by_week) {
                weekChart = new Chart(weekCtx, {
                type: 'line',
                data: {
                    labels: reportsData.by_week.map(w => `Week ${w.week}`),
                    datasets: [{
                        label: 'Hours Logged',
                        data: reportsData.by_week.map(w => w.hours || 0),
                        borderColor: 'var(--accent)',
                        backgroundColor: 'rgba(0, 102, 255, 0.1)',
                        fill: true
                    }, {
                        label: 'Target (24h/week)',
                        data: reportsData.by_week.map(() => 24),
                        type: 'line',
                        borderColor: 'var(--success)',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: colors.textColor
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: colors.textColor,
                                font: { size: 13 }
                            },
                            grid: { color: colors.gridColor }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: colors.textColor,
                                font: { size: 13 }
                            },
                            grid: { color: colors.gridColor },
                            title: {
                                display: true,
                                text: 'Hours',
                                color: colors.textColor,
                                font: { size: 13 }
                            }
                        }
                    }
                }
                });
            }
            
            // Add zero-state handling for charts
            const charts = [phaseChart, typeChart, weekChart];
            charts.forEach((chart, index) => {
                if (chart && chart.data.datasets[0].data.every(v => v === 0 || !v)) {
                    const canvas = chart.canvas;
                    const container = canvas.parentElement;
                    const zeroState = document.createElement('div');
                    zeroState.className = 'chart-zero-state';
                    zeroState.innerHTML = `
                        <i class="fas fa-chart-line"></i>
                        <p>No data available for this period</p>
                    `;
                    container.appendChild(zeroState);
                }
            });
        }
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            updateThemeIcon();
            updateChartColors();
        }
        
        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            const icon = document.querySelector('.theme-icon');
            if (icon) {
                icon.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            }
        }
        
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Back button function
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = '/';
            }
        }
        
        // Generate breadcrumbs dynamically
        function generateBreadcrumbs() {
            const breadcrumbs = document.getElementById('breadcrumbs');
            if (!breadcrumbs) return;
            
            const path = window.location.pathname;
            const parts = path.split('/').filter(Boolean);
            
            if (parts.length === 0) {
                breadcrumbs.innerHTML = '<span>Dashboard</span>';
                return;
            }
            
            let html = '<a href="/" class="hover:text-accent">Dashboard</a>';
            
            const routeNames = {
                'resources': 'Curriculum',
                'curriculum': 'Curriculum',
                'journal': 'Journal',
                'calendar': 'Calendar',
                'reports': 'Reports',
                'activity': 'Activity',
                'view': 'Week View',
                'edit': 'Edit'
            };
            
            let currentPath = '';
            parts.forEach((part, index) => {
                currentPath += '/' + part;
                
                if (part === 'calendar' && parts.length > index + 1) {
                    const year = parts[index + 1];
                    const month = parts[index + 2];
                    if (month) {
                        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                           'July', 'August', 'September', 'October', 'November', 'December'];
                        const monthName = monthNames[parseInt(month) - 1] || month;
                        html += ` <i class="fas fa-chevron-right text-xs"></i> <span>${monthName} ${year}</span>`;
                        return;
                    }
                }
                
                if (part === 'view' && parts.length > index + 1) {
                    const phaseIndex = parseInt(parts[index + 1]);
                    const week = parts[index + 2];
                    if (week) {
                        html += ` <i class="fas fa-chevron-right text-xs"></i> <span>Phase ${phaseIndex + 1} > Week ${week}</span>`;
                        return;
                    }
                }
                
                if (index > 0 && parts[index - 1] === 'calendar' && (part.match(/^\d+$/) || index === 1)) {
                    return;
                }
                if (index > 0 && parts[index - 1] === 'view' && part.match(/^\d+$/)) {
                    return;
                }
                
                const name = routeNames[part] || part.charAt(0).toUpperCase() + part.slice(1);
                
                if (index === parts.length - 1) {
                    html += ` <i class="fas fa-chevron-right text-xs"></i> <span>${name}</span>`;
                } else {
                    html += ` <i class="fas fa-chevron-right text-xs"></i> <a href="${currentPath}" class="hover:text-accent">${name}</a>`;
                }
            });
            
            breadcrumbs.innerHTML = html;
        }
        
        // Initialize charts and theme icon
        document.addEventListener('DOMContentLoaded', function() {
            createCharts();
            updateThemeIcon();
            generateBreadcrumbs();
        });
    </script>
    <script src="/static/js/report-customization.js"></script>
    <script src="/static/js/goal-tracking.js"></script>
    </main>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Toast Notification Script -->
    <script>
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const iconMap = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${iconMap[type] || iconMap.info}"></i>
                </div>
                <div class="toast-content">${message}</div>
                <button class="toast-close" onclick="removeToast(this.parentElement)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                removeToast(toast);
            }, duration);
        }
        
        function removeToast(toast) {
            if (!toast) return;
            toast.classList.add('removing');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }
    </script>
    </div> <!-- End main-content-wrapper -->
    </body>
</html>

